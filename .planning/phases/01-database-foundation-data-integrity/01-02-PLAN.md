---
phase: 01-database-foundation-data-integrity
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - apps/backend/src/database/factories/product.factory.ts
  - apps/backend/src/database/seeds/brand.seeder.ts
  - apps/backend/src/database/seeds/category.seeder.ts
  - apps/backend/src/database/seeds/product.seeder.ts
  - apps/backend/src/database/seeds/run-seeder.ts
  - apps/backend/package.json
autonomous: true

must_haves:
  truths:
    - "Running npm run seed populates the database with brands, categories, and products"
    - "Seed data includes products from Nike, Adidas, Puma, and On Cloud"
    - "Each product has multiple images and size/color variants"
    - "Products have realistic names, descriptions, and prices for real shoe models"
    - "Seeder is idempotent - running twice does not create duplicates"
  artifacts:
    - path: "apps/backend/src/database/seeds/run-seeder.ts"
      provides: "Seeder entry point"
      contains: "runSeeding"
    - path: "apps/backend/src/database/seeds/brand.seeder.ts"
      provides: "Nike, Adidas, Puma, On Cloud brand data"
      contains: "BrandSeeder"
    - path: "apps/backend/src/database/seeds/category.seeder.ts"
      provides: "Running, Basketball, Lifestyle, etc. category data"
      contains: "CategorySeeder"
    - path: "apps/backend/src/database/seeds/product.seeder.ts"
      provides: "Real shoe products with images and variants"
      contains: "ProductSeeder"
    - path: "apps/backend/src/database/factories/product.factory.ts"
      provides: "Product factory for realistic data generation"
      contains: "setSeederFactory"
  key_links:
    - from: "apps/backend/src/database/seeds/run-seeder.ts"
      to: "apps/backend/src/database/data-source.ts"
      via: "imports dataSourceOptions"
      pattern: "import.*data-source"
    - from: "apps/backend/src/database/seeds/product.seeder.ts"
      to: "apps/backend/src/products/entities/product.entity.ts"
      via: "uses Product entity repository"
      pattern: "getRepository.*Product"
    - from: "apps/backend/src/database/seeds/product.seeder.ts"
      to: "apps/backend/src/products/entities/product-image.entity.ts"
      via: "creates product images"
      pattern: "ProductImage"
---

<objective>
Install seeding dependencies and create seeders with real multi-brand shoe product data.

Purpose: Fulfill DB-04 (real shoe products from 4 brands with authentic images) and provide a repeatable way to populate the development database. This replaces the existing SQL-based seed data with TypeORM-based seeding using typeorm-extension factories.
Output: Working `npm run seed` command that populates brands, categories, products, images, and variants.
</objective>

<execution_context>
@C:/Users/Yarin David/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Yarin David/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-database-foundation-data-integrity/01-RESEARCH.md
@.planning/phases/01-database-foundation-data-integrity/01-01-SUMMARY.md
@apps/backend/src/database/data-source.ts
@apps/backend/src/products/entities/product.entity.ts
@apps/backend/src/products/entities/product-image.entity.ts
@apps/backend/src/products/entities/product-variant.entity.ts
@apps/backend/src/brands/entities/brand.entity.ts
@apps/backend/src/categories/entities/category.entity.ts
@database/migrations/001_initial_schema.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install seeding dependencies and create seeders</name>
  <files>
    apps/backend/package.json
    apps/backend/src/database/factories/product.factory.ts
    apps/backend/src/database/seeds/brand.seeder.ts
    apps/backend/src/database/seeds/category.seeder.ts
    apps/backend/src/database/seeds/product.seeder.ts
    apps/backend/src/database/seeds/run-seeder.ts
  </files>
  <action>
    1. Install dependencies:
       ```bash
       cd apps/backend && npm install typeorm-extension @faker-js/faker --save-dev
       ```

    2. Create `apps/backend/src/database/seeds/brand.seeder.ts`:
       - Implements Seeder from typeorm-extension
       - Check if brands exist (idempotent) - skip if count > 0
       - Insert 4 brands: Nike (slug: nike), Adidas (slug: adidas), Puma (slug: puma), On Cloud (slug: on-cloud)
       - Each with name, slug, description, logoUrl (use placeholder URLs like /logos/nike.svg for now)

    3. Create `apps/backend/src/database/seeds/category.seeder.ts`:
       - Implements Seeder from typeorm-extension
       - Check if categories exist (idempotent)
       - Insert categories: Running, Basketball, Lifestyle, Training, Walking
       - Each with name, slug, description

    4. Create `apps/backend/src/database/factories/product.factory.ts`:
       - Use setSeederFactory from typeorm-extension
       - Generate realistic shoe names from real model names (Air Max 90, Ultraboost, Cloudswift, RS-X3, etc.)
       - Price range: $80-$250 (NUMERIC, not float)
       - 20% chance of sale price (10-30% discount)
       - 30% chance of isFeatured
       - Realistic descriptions mentioning cushioning, mesh, rubber outsole, etc.

    5. Create `apps/backend/src/database/seeds/product.seeder.ts`:
       - Depends on brands and categories being seeded first
       - Create specific real shoe products (not random), at minimum:
         - Nike: Air Max 90, Air Force 1, React Infinity Run, Pegasus 40 (4 products)
         - Adidas: Ultraboost 22, NMD_R1, Superstar, Forum Low (4 products)
         - Puma: RS-X3, Suede Classic, Future Rider (3 products)
         - On Cloud: Cloudstratus, Cloudswift, Cloudflow (3 products)
       - For each product:
         - 3-5 images using Unsplash shoe photo URLs (legally clear source). Use real Unsplash URLs like `https://images.unsplash.com/photo-XXXXX?w=800&q=80`. First image is isPrimary=true.
         - 6 variants: sizes 8, 9, 10, 11 x colors Black, White (or brand-appropriate colors). Each with SKU format BRANDPREFIX-COLOR-SIZE, stockQuantity 5-25.
       - Idempotent: check if products exist before inserting
       - Use `factoryManager.get(Product)` for random products, but also create the 14 specific products above with hardcoded data for authenticity

    6. Create `apps/backend/src/database/seeds/run-seeder.ts`:
       - Import dataSourceOptions from ../data-source
       - Create new DataSource, initialize it
       - Run seeders in order: BrandSeeder, CategorySeeder, ProductSeeder
       - Register factories
       - Destroy DataSource when done
       - Log progress

    7. Add seed script to `apps/backend/package.json`:
       - "seed": "ts-node -r tsconfig-paths/register src/database/seeds/run-seeder.ts"

    IMPORTANT: Use getRepository pattern (raw SQL via queryRunner is for migrations only). Seeders CAN import entities since they run against the current schema.

    IMPORTANT: For Unsplash URLs, use real photo IDs from shoe photography. Example valid IDs:
    - photo-1542291026-7eec264c27ff (red Nike shoe)
    - photo-1608231387042-66d1773070a5 (white sneaker)
    - photo-1600185365926-3a2ce3cdb9eb (running shoe)
    Use different IDs per product for visual variety.
  </action>
  <verify>
    1. `npm run build` from repo root succeeds
    2. `cd apps/backend && npx ts-node -e "import { dataSourceOptions } from './src/database/data-source'; console.log('OK')"` works
    3. Verify all seeder files exist and export correct classes
    4. If database is available: `cd apps/backend && npm run seed` completes without errors
  </verify>
  <done>
    - 4 brands, 5 categories, 14+ products seeded with images and variants
    - `npm run seed` is idempotent (safe to run multiple times)
    - Each product has 3-5 images and 6+ variants with size/color/SKU/stock
    - Products represent real shoe models from Nike, Adidas, Puma, On Cloud
  </done>
</task>

</tasks>

<verification>
1. `npm run build` from repo root succeeds
2. All seeder files exist in apps/backend/src/database/seeds/
3. Factory file exists in apps/backend/src/database/factories/
4. `npm run seed` script exists in package.json
5. Brand seeder contains Nike, Adidas, Puma, On Cloud
6. Product seeder contains at least 14 specific real shoe models
7. Each product has image and variant creation logic
8. All seeders check for existing data before inserting (idempotent)
</verification>

<success_criteria>
- `npm run seed` command exists and is functional
- Seeders create 4 brands, 5 categories, 14+ products
- Each product has multiple images (3-5) with one primary
- Each product has size/color variants with SKU and stock
- Seeders are idempotent (no duplicates on re-run)
- Backend builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-database-foundation-data-integrity/01-02-SUMMARY.md`
</output>
